let data = [
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'AT',
      time_period: 2015,
      obs_value: 10125,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 90630,
      road_deaths_per_million_inhabitants: 479
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'AT',
      time_period: 2016,
      obs_value: 14459,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 93090,
      road_deaths_per_million_inhabitants: 432
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'AT',
      time_period: 2017,
      obs_value: 20180,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 94757,
      road_deaths_per_million_inhabitants: 414
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'BE',
      time_period: 2013,
      obs_value: 18859,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 132615,
      road_deaths_per_million_inhabitants: 764
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'BG',
      time_period: 2020,
      obs_value: 352488,
      obs_flag: 's',
      millions_of_passenger_per_kilometres: 8952700,
      road_deaths_per_million_inhabitants: 463
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'BG',
      time_period: 2021,
      obs_value: 374094,
      obs_flag: 's',
      millions_of_passenger_per_kilometres: 4803,
      road_deaths_per_million_inhabitants: 561
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'CZ',
      time_period: 2016,
      obs_value: 15885,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 87257,
      road_deaths_per_million_inhabitants: 611
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'CZ',
      time_period: 2017,
      obs_value: 18321,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 90049,
      road_deaths_per_million_inhabitants: 577
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'CZ',
      time_period: 2018,
      obs_value: 128315,
      obs_flag: 'b',
      millions_of_passenger_per_kilometres: 94193,
      road_deaths_per_million_inhabitants: 656
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'DE',
      time_period: 2020,
      obs_value: 749305,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 866646,
      road_deaths_per_million_inhabitants: 2719
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'DE',
      time_period: 2021,
      obs_value: 1042733,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 881373,
      road_deaths_per_million_inhabitants: 2562
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'DE',
      time_period: 2022,
      obs_value: 1431375,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 922440,
      road_deaths_per_million_inhabitants: 2788
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'DK',
      time_period: 2020,
      obs_value: 32140,
      obs_flag:    '',
      millions_of_passenger_per_kilometres: 69077,
      road_deaths_per_million_inhabitants: 163
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'DK',
      time_period: 2021,
      obs_value: 66926,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 71852,
      road_deaths_per_million_inhabitants: 130
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'DK',
      time_period: 2022,
      obs_value: 112952,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 76657,
      road_deaths_per_million_inhabitants: 154
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'ES',
      time_period: 2014,
      obs_value: 8059,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 350393,
      road_deaths_per_million_inhabitants: 1680
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'ES',
      time_period: 2015,
      obs_value: 13290,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 366092,
      road_deaths_per_million_inhabitants: 1689
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'FI',
      time_period: 2018,
      obs_value: 12688,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 75961,
      road_deaths_per_million_inhabitants: 239
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'FI',
      time_period: 2019,
      obs_value: 19106,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 75861,
      road_deaths_per_million_inhabitants: 211
    },
    {
      dataflow: 'ESTAT:ROAD_EQS_CARPDA(1.0)',
      last_update: '16/01/24 23:00:00',
      freq: 'A',
      unit: 'NR',
      mot_nrg: 'ALT',
      geo: 'FI',
      time_period: 2020,
      obs_value: 27694,
      obs_flag: '',
      millions_of_passenger_per_kilometres: 72061,
      road_deaths_per_million_inhabitants: 223
    }]
    const datos = data.map((entry, index) => {
        const { dataflow, last_update, ...rest } = entry;
        return { id: index + 1, ...rest };
});
  
module.exports = datos;

function calcularPorcentajeMuertosPorKilometro(datos) {
    let aux = new Map();

    datos.forEach(obj => {
        let pais = obj.get('geo');
        let muertos = parseFloat(obj.get('road_deaths_per_million_inhabitants'));
        let kilometros = parseFloat(obj.get('millions_of_passenger_per_kilometres'));

        if (aux.has(pais)) {
            let promedioAnterior = aux.get(pais);
            let promedioMuertos = (promedioAnterior.muertos * promedioAnterior.contador + muertos) / (promedioAnterior.contador + 1);
            let promedioKm = (promedioAnterior.kilometros * promedioAnterior.contador + kilometros) / (promedioAnterior.contador + 1);
            aux.set(pais, { muertos: promedioMuertos, kilometros: promedioKm, contador: promedioAnterior.contador + 1 });
        } else {
            aux.set(pais, { muertos: muertos, kilometros: kilometros, contador: 1 });
        }
    });

    let resultados = {};
    aux.forEach((valor, clave) => {
        resultados[clave] = (valor.muertos / valor.kilometros) * 100;
    });

    return resultados;
}

let res = calcularPorcentajeMuertosPorKilometro(datos);
// console.log('Porcentaje de muertos en carretera por kilómetro de carretera por país:');
// console.log(res);
